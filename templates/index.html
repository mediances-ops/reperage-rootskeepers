<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pr√©paration Rep√©rage - RootsKeepers</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Quill WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    
    <!-- HEADER -->
    <header class="{% if FIXER_DATA %}header-fixer{% endif %}">
        {% if FIXER_DATA and FIXER_DATA.region %}
        <!-- Header personnalis√© pour les fixers avec image de fond -->
        <div class="header-fixer-banner" style="background-image: url('{% if FIXER_DATA.image_region %}{{ FIXER_DATA.image_region }}{% else %}https://destinationsetcuisines.com/doc/multilingue/bannerreperage.jpg{% endif %}');">
            <div class="header-fixer-overlay">
                <img src="https://destinationsetcuisines.com/doc/logoRK.png" alt="RootsKeepers" class="logo-header-fixer">
                <div class="header-fixer-content">
                    <h1 class="header-fixer-title"></h1>
                    <h2 class="header-fixer-region">{{ FIXER_DATA.region }}</h2>
                    <div class="header-fixer-name">{{ FIXER_DATA.prenom }} {{ FIXER_DATA.nom }}</div>
                </div>
            </div>
        </div>
        <div class="header-content">
            <div class="language-selector">
                <button class="lang-btn" data-lang="FR">üá´üá∑ FR</button>
                <button class="lang-btn" data-lang="GB">üá¨üáß GB</button>
                <button class="lang-btn" data-lang="ITAL">üáÆüáπ ITAL</button>
                <button class="lang-btn" data-lang="ESP">üá™üá∏ ESP</button>
            </div>
        </div>
        {% else %}
        <!-- Header standard pour l'admin -->
        <div class="header-content">
            <div class="header-title">
                <h1></h1>
                <div class="subtitle">RootsKeepers</div>
            </div>
            <div class="language-selector">
                <button class="lang-btn" data-lang="FR">üá´üá∑ FR</button>
                <button class="lang-btn" data-lang="GB">üá¨üáß GB</button>
                <button class="lang-btn" data-lang="ITAL">üáÆüáπ ITAL</button>
                <button class="lang-btn" data-lang="ESP">üá™üá∏ ESP</button>
            </div>
        </div>
        {% endif %}
    </header>
    
    <div class="container">
        
        <!-- COMPTEUR DE PROGRESSION -->
        <div class="progress-container" id="progress-container">
            <div class="progress-header">
                <div class="progress-title">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <span>Progress..</span>
                </div>
                <div class="progress-percentage" id="progress-percentage">0%</div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
            </div>
            <div class="progress-stats">
                <span id="progress-filled">0</span> champs remplis sur 
                <span id="progress-total">0</span>
            </div>
        </div>
        
        <!-- INTRODUCTION 
        <div class="intro-box">
            <p>Le rep√©rage n'est pas qu'une √©tape logistique : c'est une phase cr√©ative et strat√©gique qui conditionne la qualit√© finale de l'√©pisode.</p>
            <p>Il valide la faisabilit√© narrative, anticipe les choix artistiques, pr√©pare la logistique technique et optimise les ressources budg√©taires.</p>
            <p>Ce document est votre Bible. <span class="highlight">Remplissez-le avec soin, pr√©cision et sensibilit√© culturelle.</span></p> 
        </div>-->
        
        <!-- INFORMATIONS CORRESPONDANT -->
        <section>
            <div class="section-header">
                <i data-lucide="user-round" style="width: 32px; height: 32px;"></i>
                <h2 class="section-title" data-i18n="fixer.title">INFORMATIONS SUR LE CORRESPONDANT LOCAL</h2>
            </div>
            
            <div class="text-content">
                <div class="fields-grid">
                    <div class="field-group">
                        <label class="field-label" data-i18n="fixer.nom">Nom</label>
                        <input type="text" name="fixer_nom" placeholder="Nom complet" data-i18n-placeholder="fixer.nom_placeholder">
                    </div>
                    <div class="field-group">
                        <label class="field-label" data-i18n="fixer.email">Email</label>
                        <input type="email" name="fixer_email" placeholder="email@example.com" data-i18n-placeholder="fixer.email_placeholder">
                    </div>
                    <div class="field-group">
                        <label class="field-label" data-i18n="fixer.telephone">T√©l√©phone</label>
                        <input type="tel" name="fixer_telephone" placeholder="+33 6 12 34 56 78" data-i18n-placeholder="fixer.telephone_placeholder">
                    </div>
                </div>
            </div>
        </section>
        
        <!-- GRILLE DE REP√âRAGE -->
        <section>
            <div class="section-header">
                <i data-lucide="clipboard-list" style="width: 32px; height: 32px;"></i>
                <h2 class="section-title" data-i18n="grille.title">GRILLE DE REP√âRAGE</h2>
            </div>
            
            <div class="tabs-container">
                <div class="tabs-header" data-i18n="tabs.territoire">Grille de Rep√©rage</div>
                
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="territoire">
                        <i data-lucide="globe" style="width: 20px; height: 20px;"></i>
                        <span data-i18n="tabs.territoire">TERRITOIRE</span>
                    </button>
                    <button class="tab-btn" data-tab="episode">
                        <i data-lucide="clapperboard" style="width: 20px; height: 20px;"></i>
                        <span data-i18n="tabs.episode">√âPISODE</span>
                    </button>
                    <button class="tab-btn" data-tab="gardiens">
                        <i data-lucide="users" style="width: 20px; height: 20px;"></i>
                        <span data-i18n="tabs.gardiens">GARDIENS</span>
                    </button>
                    <button class="tab-btn" data-tab="gardiens-details">
                        <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
                        <span data-i18n="tabs.gardiens_details">GARDIENS (D√âTAILS)</span>
                    </button>
                    <button class="tab-btn" data-tab="lieux">
                        <i data-lucide="map-pin" style="width: 20px; height: 20px;"></i>
                        <span data-i18n="tabs.lieux">LIEUX</span>
                    </button>
                </div>
                
                <!-- TAB: TERRITOIRE -->
                <div class="tab-content active" id="territoire">
                    <h3 style="font-size: 1.4rem; color: var(--dark-color); margin-bottom: 25px;" data-i18n="territoire.title">Identit√© du territoire</h3>
                    
                    <div class="fields-grid">
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.pays">Pays</label>
                            <input type="text" name="pays" data-i18n-placeholder="territoire.pays">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.region">R√©gion / Province</label>
                            <input type="text" name="region" data-i18n-placeholder="territoire.region">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.ville">Ville(s) principale(s)</label>
                            <input type="text" name="ville" data-i18n-placeholder="territoire.ville">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.population">Population (estimation)</label>
                            <input type="text" name="population" data-i18n-placeholder="territoire.population">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.langues">Langue(s) parl√©e(s)</label>
                            <input type="text" name="langues" data-i18n-placeholder="territoire.langues">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.climat">Climat / Saison de tournage envisag√©e</label>
                            <input type="text" name="climat" data-i18n-placeholder="territoire.climat">
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="territoire.histoire">Histoire / Contexte culturel</label>
                            <textarea name="histoire" rows="4" data-i18n-placeholder="territoire.histoire"></textarea></textarea>
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="territoire.traditions">Traditions culinaires / artisanales dominantes</label>
                            <textarea name="traditions" rows="3" data-i18n-placeholder="territoire.traditions"></textarea></textarea>
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="territoire.fetes">F√™tes locales / Calendrier culturel</label>
                            <textarea name="fetes" rows="3" data-i18n-placeholder="territoire.fetes"></textarea></textarea>
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.acces">Acc√®s depuis capitale / a√©roport</label>
                            <input type="text" name="acces" data-i18n-placeholder="territoire.acces">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="territoire.hebergement">H√©bergement √©quipe disponible</label>
                            <input type="text" name="hebergement" data-i18n-placeholder="territoire.hebergement">
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="territoire.contacts">Contacts locaux utiles</label>
                            <textarea name="contacts" rows="2" data-i18n-placeholder="territoire.contacts"></textarea></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- TAB: √âPISODE -->
                <div class="tab-content" id="episode">
                    <h3 style="font-size: 1.4rem; color: var(--dark-color); margin-bottom: 25px;" data-i18n="episode.title">√âpisode</h3>
                    
                    <div class="fields-grid">
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="episode.angle">Angle narratif choisi</label>
                            <textarea name="angle" rows="3" data-i18n-placeholder="episode.angle"></textarea></textarea>
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="episode.fete">F√™te ou √©v√©nement central</label>
                            <input type="text" name="fete" data-i18n-placeholder="episode.fete">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="episode.contraintes">Contraintes temporelles</label>
                            <input type="text" name="contraintes" data-i18n-placeholder="episode.contraintes">
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="episode.arc">Arc dramatique envisag√©</label>
                            <textarea name="arc" rows="4" data-i18n-placeholder="episode.arc"></textarea></textarea>
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="episode.moments">Moments-cl√©s identifi√©s</label>
                            <textarea name="moments" rows="4" data-i18n-placeholder="episode.moments"></textarea></textarea>
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="episode.sensibles">√âl√©ments culturellement sensibles</label>
                            <textarea name="sensibles" rows="3" data-i18n-placeholder="episode.sensibles"></textarea></textarea>
                        </div>
                        <div class="field-group" style="grid-column: span 2;">
                            <label class="field-label" data-i18n="episode.autorisations">Autorisations pr√©alables n√©cessaires</label>
                            <textarea name="autorisations" rows="3" data-i18n-placeholder="episode.autorisations"></textarea></textarea>
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="episode.budget">Budget local estim√©</label>
                            <input type="text" name="budget" data-i18n-placeholder="episode.budget">
                        </div>
                        <div class="field-group">
                            <label class="field-label" data-i18n="episode.notes">Notes production</label>
                            <textarea name="notes" rows="3" data-i18n-placeholder="episode.notes"></textarea></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- TAB: GARDIENS VUE D'ENSEMBLE -->
                <div class="tab-content" id="gardiens">
                    <h3 style="font-size: 1.4rem; color: var(--dark-color); margin-bottom: 25px;" data-i18n="gardiens_vue.title">Vue d'ensemble des 3 Gardiens</h3>
                    
                    <table class="gardiens-table">
                        <thead>
                            <tr>
                                <th data-i18n="gardiens_vue.gardien">Gardien</th>
                                <th data-i18n="gardiens_vue.nom">Nom / Pr√©nom</th>
                                <th data-i18n="gardiens_vue.age">√Çge</th>
                                <th data-i18n="gardiens_vue.genre">Genre</th>
                                <th data-i18n="gardiens_vue.fonction">Fonction</th>
                                <th data-i18n="gardiens_vue.savoir">Savoir transmis</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Gardien 1</strong></td>
                                <td><input type="text" name="gardien1_nom"></td>
                                <td><input type="number" name="gardien1_age"></td>
                                <td><input type="text" name="gardien1_genre"></td>
                                <td><input type="text" name="gardien1_fonction"></td>
                                <td><input type="text" name="gardien1_savoir"></td>
                            </tr>
                            <tr>
                                <td><strong>Gardien 2</strong></td>
                                <td><input type="text" name="gardien2_nom"></td>
                                <td><input type="number" name="gardien2_age"></td>
                                <td><input type="text" name="gardien2_genre"></td>
                                <td><input type="text" name="gardien2_fonction"></td>
                                <td><input type="text" name="gardien2_savoir"></td>
                            </tr>
                            <tr>
                                <td><strong>Gardien 3</strong></td>
                                <td><input type="text" name="gardien3_nom"></td>
                                <td><input type="number" name="gardien3_age"></td>
                                <td><input type="text" name="gardien3_genre"></td>
                                <td><input type="text" name="gardien3_fonction"></td>
                                <td><input type="text" name="gardien3_savoir"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- TAB: GARDIENS D√âTAILS -->
                <div class="tab-content" id="gardiens-details">
                    <h3 style="font-size: 1.4rem; color: var(--dark-color); margin-bottom: 25px;" data-i18n="gardiens_details.title">D√©tails des Gardiens</h3>
                    
                    <!-- Gardien 1 -->
                    <div class="sub-section">
                        <div class="sub-section-title">Gardien 1</div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.prenom">Pr√©nom</label>
                                <input type="text" name="gardien1_prenom" data-i18n-placeholder="gardiens_details.prenom">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.telephone">T√©l√©phone</label>
                                <input type="tel" name="gardien1_telephone" data-i18n-placeholder="gardiens_details.telephone">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.email">Email</label>
                                <input type="email" name="gardien1_email" data-i18n-placeholder="gardiens_details.email">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.langues">Langues parl√©es</label>
                                <input type="text" name="gardien1_langues" data-i18n-placeholder="gardiens_details.langues">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.adresse">Adresse compl√®te</label>
                                <input type="text" name="gardien1_adresse" data-i18n-placeholder="gardiens_details.adresse">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.histoire">Histoire personnelle / Parcours de transmission</label>
                                <textarea name="gardien1_histoire" rows="4" data-i18n-placeholder="gardiens_details.histoire"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.evaluation">√âvaluation cin√©g√©nie / Capacit√© de transmission</label>
                                <textarea name="gardien1_evaluation" rows="3" data-i18n-placeholder="gardiens_details.evaluation"></textarea></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gardien 2 (m√™me structure) -->
                    <div class="sub-section">
                        <div class="sub-section-title">Gardien 2</div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.prenom">Pr√©nom</label>
                                <input type="text" name="gardien2_prenom" data-i18n-placeholder="gardiens_details.prenom">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.telephone">T√©l√©phone</label>
                                <input type="tel" name="gardien2_telephone" data-i18n-placeholder="gardiens_details.telephone">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.email">Email</label>
                                <input type="email" name="gardien2_email" data-i18n-placeholder="gardiens_details.email">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.langues">Langues parl√©es</label>
                                <input type="text" name="gardien2_langues" data-i18n-placeholder="gardiens_details.langues">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.adresse">Adresse compl√®te</label>
                                <input type="text" name="gardien2_adresse" data-i18n-placeholder="gardiens_details.adresse">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.histoire">Histoire personnelle</label>
                                <textarea name="gardien2_histoire" rows="4" data-i18n-placeholder="gardiens_details.histoire"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.evaluation">√âvaluation cin√©g√©nie</label>
                                <textarea name="gardien2_evaluation" rows="3" data-i18n-placeholder="gardiens_details.evaluation"></textarea></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gardien 3 (m√™me structure) -->
                    <div class="sub-section">
                        <div class="sub-section-title">Gardien 3</div>
                        <div class="fields-grid">
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.prenom">Pr√©nom</label>
                                <input type="text" name="gardien3_prenom" data-i18n-placeholder="gardiens_details.prenom">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.telephone">T√©l√©phone</label>
                                <input type="tel" name="gardien3_telephone" data-i18n-placeholder="gardiens_details.telephone">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.email">Email</label>
                                <input type="email" name="gardien3_email" data-i18n-placeholder="gardiens_details.email">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="gardiens_details.langues">Langues parl√©es</label>
                                <input type="text" name="gardien3_langues" data-i18n-placeholder="gardiens_details.langues">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.adresse">Adresse compl√®te</label>
                                <input type="text" name="gardien3_adresse" data-i18n-placeholder="gardiens_details.adresse">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.histoire">Histoire personnelle</label>
                                <textarea name="gardien3_histoire" rows="4" data-i18n-placeholder="gardiens_details.histoire"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="gardiens_details.evaluation">√âvaluation cin√©g√©nie</label>
                                <textarea name="gardien3_evaluation" rows="3" data-i18n-placeholder="gardiens_details.evaluation"></textarea></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- TAB: LIEUX -->
                <div class="tab-content" id="lieux">
                    <h3 style="font-size: 1.4rem; color: var(--dark-color); margin-bottom: 25px;" data-i18n="lieux.title">Lieux</h3>
                    
                    <!-- TABS POUR LES 3 LIEUX -->
                    <div class="lieux-tabs-container">
                        <div class="lieux-tabs">
                            <button class="lieu-tab active" data-lieu="1">Lieu 1</button>
                            <button class="lieu-tab" data-lieu="2">Lieu 2</button>
                            <button class="lieu-tab" data-lieu="3">Lieu 3</button>
                        </div>
                    </div>

                    <!-- LIEU 1 -->
                    <div class="lieu-content active" id="lieu-1">
                        <div class="fields-grid">
                            <div class="field-group">
                                <label class="field-label" data-i18n="lieux.nom">Nom du lieu</label>
                                <input type="text" name="lieu1_nom" data-i18n-placeholder="lieux.nom">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="lieux.type">Type d'environnement</label>
                                <input type="text" name="lieu1_type" data-i18n-placeholder="lieux.type">
                                <div class="field-hint" data-i18n="lieux.type_hint">village, maison, march√©, etc.</div>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.description">Description visuelle g√©n√©rale</label>
                                <textarea name="lieu1_description" rows="4" data-i18n-placeholder="lieux.description"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.elements">√âl√©ments symboliques</label>
                                <textarea name="lieu1_elements" rows="3" data-i18n-placeholder="lieux.elements"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.points_vue">Points de vue remarquables</label>
                                <textarea name="lieu1_points_vue" rows="3" data-i18n-placeholder="lieux.points_vue"></textarea></textarea>
                            </div>
                        </div>
                        
                        <div class="sub-section">
                            <div class="sub-section-title" data-i18n="lieux.analyse_artistique">Analyse artistique</div>
                            <div class="fields-grid">
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.cinegenie">Cin√©g√©nie du lieu</label>
                                    <textarea name="lieu1_cinegenie" rows="3" data-i18n-placeholder="lieux.cinegenie"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.axes">Axes de cam√©ra possibles</label>
                                    <textarea name="lieu1_axes" rows="3" data-i18n-placeholder="lieux.axes"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.moments">Moments favorables (lumi√®re)</label>
                                    <input type="text" name="lieu1_moments" data-i18n-placeholder="lieux.moments">
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.ambiance">Ambiance sonore</label>
                                    <input type="text" name="lieu1_ambiance" data-i18n-placeholder="lieux.ambiance">
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.adequation">Ad√©quation avec la narration</label>
                                    <textarea name="lieu1_adequation" rows="3" data-i18n-placeholder="lieux.adequation"></textarea></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sub-section">
                            <div class="sub-section-title" data-i18n="lieux.analyse_technique">Analyse technique & logistique</div>
                            <div class="fields-grid">
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.accessibilite">Accessibilit√©</label>
                                    <textarea name="lieu1_accessibilite" rows="2" data-i18n-placeholder="lieux.accessibilite"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.securite">S√©curit√©</label>
                                    <textarea name="lieu1_securite" rows="2" data-i18n-placeholder="lieux.securite"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.electricite">√âlectricit√©</label>
                                    <input type="text" name="lieu1_electricite" data-i18n-placeholder="lieux.electricite">
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.espace">Espace √©quipe/mat√©riel</label>
                                    <input type="text" name="lieu1_espace" data-i18n-placeholder="lieux.espace">
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.protection">Protection m√©t√©o disponible</label>
                                    <textarea name="lieu1_protection" rows="2" data-i18n-placeholder="lieux.protection"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.contraintes_meteo">Contraintes m√©t√©orologiques</label>
                                    <textarea name="lieu1_contraintes_meteo" rows="2" data-i18n-placeholder="lieux.contraintes_meteo"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.autorisations">Autorisations n√©cessaires</label>
                                    <textarea name="lieu1_autorisations" rows="2" data-i18n-placeholder="lieux.autorisations"></textarea></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LIEU 2 (m√™me structure) -->
                    <div class="lieu-content" id="lieu-2">
                        <div class="fields-grid">
                            <div class="field-group">
                                <label class="field-label" data-i18n="lieux.nom">Nom du lieu</label>
                                <input type="text" name="lieu2_nom" data-i18n-placeholder="lieux.nom">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="lieux.type">Type d'environnement</label>
                                <input type="text" name="lieu2_type" data-i18n-placeholder="lieux.type">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.description">Description visuelle g√©n√©rale</label>
                                <textarea name="lieu2_description" rows="4" data-i18n-placeholder="lieux.description"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.elements">√âl√©ments symboliques</label>
                                <textarea name="lieu2_elements" rows="3" data-i18n-placeholder="lieux.elements"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.points_vue">Points de vue remarquables</label>
                                <textarea name="lieu2_points_vue" rows="3" data-i18n-placeholder="lieux.points_vue"></textarea></textarea>
                            </div>
                        </div>
                        
                        <div class="sub-section">
                            <div class="sub-section-title" data-i18n="lieux.analyse_artistique">Analyse artistique</div>
                            <div class="fields-grid">
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.cinegenie">Cin√©g√©nie du lieu</label>
                                    <textarea name="lieu2_cinegenie" rows="3" data-i18n-placeholder="lieux.cinegenie"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.axes">Axes de cam√©ra possibles</label>
                                    <textarea name="lieu2_axes" rows="3" data-i18n-placeholder="lieux.axes"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.moments">Moments favorables (lumi√®re)</label>
                                    <input type="text" name="lieu2_moments" data-i18n-placeholder="lieux.moments">
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.ambiance">Ambiance sonore</label>
                                    <input type="text" name="lieu2_ambiance" data-i18n-placeholder="lieux.ambiance">
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.adequation">Ad√©quation avec la narration</label>
                                    <textarea name="lieu2_adequation" rows="3" data-i18n-placeholder="lieux.adequation"></textarea></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sub-section">
                            <div class="sub-section-title" data-i18n="lieux.analyse_technique">Analyse technique & logistique</div>
                            <div class="fields-grid">
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.accessibilite">Accessibilit√©</label>
                                    <textarea name="lieu2_accessibilite" rows="2" data-i18n-placeholder="lieux.accessibilite"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.securite">S√©curit√©</label>
                                    <textarea name="lieu2_securite" rows="2" data-i18n-placeholder="lieux.securite"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.electricite">√âlectricit√©</label>
                                    <input type="text" name="lieu2_electricite" data-i18n-placeholder="lieux.electricite">
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.espace">Espace √©quipe/mat√©riel</label>
                                    <input type="text" name="lieu2_espace" data-i18n-placeholder="lieux.espace">
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.protection">Protection m√©t√©o disponible</label>
                                    <textarea name="lieu2_protection" rows="2" data-i18n-placeholder="lieux.protection"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.contraintes_meteo">Contraintes m√©t√©orologiques</label>
                                    <textarea name="lieu2_contraintes_meteo" rows="2" data-i18n-placeholder="lieux.contraintes_meteo"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.autorisations">Autorisations n√©cessaires</label>
                                    <textarea name="lieu2_autorisations" rows="2" data-i18n-placeholder="lieux.autorisations"></textarea></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- LIEU 3 (m√™me structure) -->
                    <div class="lieu-content" id="lieu-3">
                        <div class="fields-grid">
                            <div class="field-group">
                                <label class="field-label" data-i18n="lieux.nom">Nom du lieu</label>
                                <input type="text" name="lieu3_nom" data-i18n-placeholder="lieux.nom">
                            </div>
                            <div class="field-group">
                                <label class="field-label" data-i18n="lieux.type">Type d'environnement</label>
                                <input type="text" name="lieu3_type" data-i18n-placeholder="lieux.type">
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.description">Description visuelle g√©n√©rale</label>
                                <textarea name="lieu3_description" rows="4" data-i18n-placeholder="lieux.description"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.elements">√âl√©ments symboliques</label>
                                <textarea name="lieu3_elements" rows="3" data-i18n-placeholder="lieux.elements"></textarea></textarea>
                            </div>
                            <div class="field-group" style="grid-column: span 2;">
                                <label class="field-label" data-i18n="lieux.points_vue">Points de vue remarquables</label>
                                <textarea name="lieu3_points_vue" rows="3" data-i18n-placeholder="lieux.points_vue"></textarea></textarea>
                            </div>
                        </div>
                        
                        <div class="sub-section">
                            <div class="sub-section-title" data-i18n="lieux.analyse_artistique">Analyse artistique</div>
                            <div class="fields-grid">
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.cinegenie">Cin√©g√©nie du lieu</label>
                                    <textarea name="lieu3_cinegenie" rows="3" data-i18n-placeholder="lieux.cinegenie"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.axes">Axes de cam√©ra possibles</label>
                                    <textarea name="lieu3_axes" rows="3" data-i18n-placeholder="lieux.axes"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.moments">Moments favorables (lumi√®re)</label>
                                    <input type="text" name="lieu3_moments" data-i18n-placeholder="lieux.moments">
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.ambiance">Ambiance sonore</label>
                                    <input type="text" name="lieu3_ambiance" data-i18n-placeholder="lieux.ambiance">
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.adequation">Ad√©quation avec la narration</label>
                                    <textarea name="lieu3_adequation" rows="3" data-i18n-placeholder="lieux.adequation"></textarea></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sub-section">
                            <div class="sub-section-title" data-i18n="lieux.analyse_technique">Analyse technique & logistique</div>
                            <div class="fields-grid">
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.accessibilite">Accessibilit√©</label>
                                    <textarea name="lieu3_accessibilite" rows="2" data-i18n-placeholder="lieux.accessibilite"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.securite">S√©curit√©</label>
                                    <textarea name="lieu3_securite" rows="2" data-i18n-placeholder="lieux.securite"></textarea></textarea>
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.electricite">√âlectricit√©</label>
                                    <input type="text" name="lieu3_electricite" data-i18n-placeholder="lieux.electricite">
                                </div>
                                <div class="field-group">
                                    <label class="field-label" data-i18n="lieux.espace">Espace √©quipe/mat√©riel</label>
                                    <input type="text" name="lieu3_espace" data-i18n-placeholder="lieux.espace">
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.protection">Protection m√©t√©o disponible</label>
                                    <textarea name="lieu3_protection" rows="2" data-i18n-placeholder="lieux.protection"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.contraintes_meteo">Contraintes m√©t√©orologiques</label>
                                    <textarea name="lieu3_contraintes_meteo" rows="2" data-i18n-placeholder="lieux.contraintes_meteo"></textarea></textarea>
                                </div>
                                <div class="field-group" style="grid-column: span 2;">
                                    <label class="field-label" data-i18n="lieux.autorisations">Autorisations n√©cessaires</label>
                                    <textarea name="lieu3_autorisations" rows="2" data-i18n-placeholder="lieux.autorisations"></textarea></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>
        
        <!-- UPLOAD PHOTOS -->
        <section>
            <div class="section-header">
                <div class="section-icon">üì∑</div>
                <h2 class="section-title">PHOTOS & DOCUMENTS</h2>
            </div>
            
            <div class="text-content">
                <div class="upload-zone">
                    <input type="file" id="file-input" multiple accept="image/*,.pdf">
                    <div class="drop-area" id="drop-area">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üì∑</div>
                        <p>Glissez vos photos ici ou cliquez pour s√©lectionner</p>
                        <small>JPG, PNG, HEIC - Max 50 MB par fichier</small>
                    </div>
                </div>
                
                <div class="upload-progress" id="upload-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">Upload en cours...</div>
                </div>
                
                <div class="files-preview" id="files-list"></div>
            </div>
        </section>
        
        <!-- ACTIONS -->
        <div class="actions-bar">
            <button class="btn btn-secondary" id="btn-save">üíæ Enregistrer</button>
            <button class="btn btn-primary" id="btn-export-pdf">üìÑ Exporter PDF</button>
            <button class="btn btn-success" id="btn-submit">‚úÖ Soumettre</button>
        </div>
        
    </div>
    
    <!-- BOUTON CHAT FLOTTANT -->
    <button class="chat-toggle-btn" id="chat-toggle-btn" title="Messages">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <span class="chat-badge" id="chat-badge">0</span>
    </button>
    
    <!-- PANNEAU CHAT LAT√âRAL -->
    <div class="chat-panel" id="chat-panel">
        <div class="chat-header">
            <div class="chat-header-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Messages Production</span>
            </div>
            <button class="chat-close-btn" id="chat-close-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <!-- Messages seront ins√©r√©s ici dynamiquement -->
            <div class="chat-empty">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <p>Aucun message pour le moment</p>
                <small>Les messages avec la production appara√Ætront ici</small>
            </div>
        </div>
        
        <div class="chat-typing-indicator" id="chat-typing" style="display: none;">
            <span></span><span></span><span></span>
            Production est en train d'√©crire...
        </div>
        
        <div class="chat-input-container">
            <textarea 
                class="chat-input" 
                id="chat-input" 
                placeholder="√âcrivez votre message..."
                rows="2"
            ></textarea>
            <button class="chat-send-btn" id="chat-send-btn" title="Envoyer (Entr√©e)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <p>¬© 2025 ‚Äî Durand & Pierson Associates</p>
            <p>D√©p√¥t e-dpo SACD</p>
        </div>
    </footer>
    
    <!-- Variables Flask pour JavaScript -->
    <script>
        // Variables pass√©es depuis Flask
        window.FIXER_DATA = {
            fixer_id: {{ fixer_id|default('null')|tojson }},
            fixer_nom: {{ fixer_nom|default('')|tojson }},
            fixer_email: {{ fixer_email|default('')|tojson }},
            fixer_telephone: {{ fixer_telephone|default('')|tojson }},
            langue_default: {{ langue_default|default('FR')|tojson }},
            reperage_id: {{ REPERAGE_ID|default('null')|tojson }},
            region: {{ FIXER_DATA.region|default('')|tojson if FIXER_DATA else '""' }},
            pays: {{ FIXER_DATA.pays|default('')|tojson if FIXER_DATA else '""' }}
        };
        console.log('üîç FIXER_DATA inject√©:', window.FIXER_DATA);
    </script>
    
    <!-- Quill.js -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <script src="/static/js/app.js"></script>
    
    <!-- Initialiser Lucide Icons -->
    <script>
        lucide.createIcons();
    </script>
    
    <!-- Initialiser WYSIWYG Quill pour textareas -->
    <script>
        function initQuillEditors() {
            if (typeof Quill === 'undefined') {
                console.log('‚è≥ Quill pas encore charg√©, on r√©essaie...');
                setTimeout(initQuillEditors, 100);
                return;
            }
            
            const textareas = document.querySelectorAll('textarea:not(#chat-input):not([data-quill-initialized])');
            
            if (textareas.length === 0) {
                console.log('‚úÖ Aucun textarea √† initialiser');
                return;
            }
            
            textareas.forEach(function(textarea) {
                // Marquer comme initialis√©
                textarea.setAttribute('data-quill-initialized', 'true');
                
                // Cr√©er conteneur Quill
                const wrapper = document.createElement('div');
                wrapper.className = 'wysiwyg-wrapper';
                textarea.parentNode.insertBefore(wrapper, textarea);
                
                // Cr√©er √©diteur Quill
                const editorDiv = document.createElement('div');
                editorDiv.className = 'wysiwyg-editor';
                wrapper.appendChild(editorDiv);
                
                // Cacher textarea original
                textarea.style.display = 'none';
                wrapper.appendChild(textarea);
                
                // Initialiser Quill avec configuration compl√®te
                const quill = new Quill(editorDiv, {
                    theme: 'snow',
                    placeholder: textarea.placeholder || '√âcrivez ici...',
                    modules: {
                        toolbar: {
                            container: [
                                ['bold', 'italic', 'underline'],
                                ['link'],
                                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                ['clean']
                            ],
                            handlers: {
                                'link': function(value) {
                                    if (value) {
                                        const href = prompt('Entrez l\'URL du lien:', 'https://');
                                        if (href) {
                                            this.quill.format('link', href);
                                        }
                                    } else {
                                        this.quill.format('link', false);
                                    }
                                }
                            }
                        }
                    }
                });
                
                // Charger contenu initial
                if (textarea.value) {
                    quill.root.innerHTML = textarea.value;
                }
                
                // Synchroniser avec textarea
                quill.on('text-change', function() {
                    textarea.value = quill.root.innerHTML;
                    // D√©clencher √©v√©nement change pour sauvegarde auto
                    textarea.dispatchEvent(new Event('change', { bubbles: true }));
                });
                
                // Stocker r√©f√©rence Quill sur textarea
                textarea.quillEditor = quill;
            });
            
            console.log('‚úÖ WYSIWYG Quill initialis√© pour', textareas.length, 'textareas');
        }
        
        // Lancer apr√®s chargement du DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initQuillEditors);
        } else {
            initQuillEditors();
        }
    </script>

    <!-- SYST√àME DE TRADUCTION MULTILINGUE -->
    <script>
        let currentLang = 'FR';
        let translations = {};

        // Charger les traductions
        async function loadTranslations() {
            try {
                const response = await fetch('/translations/i18n.json');
                translations = await response.json();
                console.log('‚úÖ Traductions charg√©es:', Object.keys(translations));
            } catch (error) {
                console.error('‚ùå Erreur chargement traductions:', error);
            }
        }

        // Appliquer les traductions
        function applyTranslations(lang) {
            currentLang = lang;
            const langData = translations[lang];
            
            if (!langData) {
                console.error('‚ùå Langue non trouv√©e:', lang);
                return;
            }

            console.log(`üåç Application traductions ${lang}...`);

            // 1. Traduire tous les √©l√©ments avec data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = getNestedTranslation(langData, key);
                
                if (translation) {
                    element.textContent = translation;
                }
            });

            // 2. Traduire tous les placeholders avec data-i18n-placeholder
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const translation = getNestedTranslation(langData, key);
                
                if (translation) {
                    element.placeholder = translation;
                }
            });

            // 3. Mettre √† jour les boutons de langue
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            console.log(`‚úÖ Traduction ${lang} appliqu√©e`);
        }

        // R√©cup√©rer traduction imbriqu√©e (ex: "territoire.nom" ‚Üí translations.FR.territoire.nom)
        function getNestedTranslation(obj, path) {
            const keys = path.split('.');
            let result = obj;
            
            for (const key of keys) {
                if (result && result[key] !== undefined) {
                    result = result[key];
                } else {
                    return null;
                }
            }
            
            return result;
        }

        // Initialiser le syst√®me de traduction
        async function initTranslationSystem() {
            await loadTranslations();
            
            // Langue par d√©faut (priorit√© : FIXER_DATA > localStorage > FR)
            let defaultLang = 'FR';
            if (window.FIXER_DATA && window.FIXER_DATA.langue_default) {
                defaultLang = window.FIXER_DATA.langue_default;
            } else if (localStorage.getItem('selectedLanguage')) {
                defaultLang = localStorage.getItem('selectedLanguage');
            }
            
            // Appliquer langue par d√©faut
            applyTranslations(defaultLang);
            
            // Ajouter √©v√©nements sur boutons langue
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.getAttribute('data-lang');
                    applyTranslations(lang);
                    localStorage.setItem('selectedLanguage', lang);
                });
            });
        }

        // Lancer au chargement
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTranslationSystem);
        } else {
            initTranslationSystem();
        }
    </script>

<!-- PANNEAU IA LAT√âRAL GAUCHE -->
<button class="ai-floating-btn" onclick="toggleAIPanel()" title="Assistant IA RootsKeepers">
    <i data-lucide="brain-circuit" style="width: 28px; height: 28px;"></i>
</button>

<div class="ai-panel-overlay" id="aiPanelOverlay" onclick="closeAIPanel()"></div>

<div class="ai-panel" id="aiPanel">
    <div class="ai-panel-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <i data-lucide="brain-circuit" style="width: 24px; height: 24px; color: white;"></i>
            <h3 style="margin: 0; color: white; font-size: 1.1rem;">Assistant IA RootsKeepers</h3>
        </div>
        <button class="ai-panel-close" onclick="closeAIPanel()">
            <i data-lucide="x" style="width: 20px; height: 20px;"></i>
        </button>
    </div>
    
    <div class="ai-panel-body">
        <iframe 
            src="https://destinationsetcuisines.com/site" 
            frameborder="0"
            style="width: 100%; height: 100%; border: none;"
            title="Assistant IA RootsKeepers"
        ></iframe>
    </div>
</div>

<script>
// PANNEAU IA - JAVASCRIPT
function toggleAIPanel() {
    const panel = document.getElementById('aiPanel');
    const overlay = document.getElementById('aiPanelOverlay');
    
    if (panel.classList.contains('active')) {
        closeAIPanel();
    } else {
        openAIPanel();
    }
}

function openAIPanel() {
    const panel = document.getElementById('aiPanel');
    const overlay = document.getElementById('aiPanelOverlay');
    
    panel.classList.add('active');
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
}

function closeAIPanel() {
    const panel = document.getElementById('aiPanel');
    const overlay = document.getElementById('aiPanelOverlay');
    
    panel.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAIPanel();
    }
});
</script>

</body>
</html>
